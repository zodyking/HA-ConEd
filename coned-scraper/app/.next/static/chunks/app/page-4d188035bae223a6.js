(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3046:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>u});var s=t(5155),r=t(2115);let n=t(5704).env.NEXT_PUBLIC_API_URL||"/api";function l(){let[e,a]=(0,r.useState)(!1),[t,l]=(0,r.useState)([]),[c,i]=(0,r.useState)("stopped"),o=(0,r.useRef)(null),[d,h]=(0,r.useState)(null),[m,u]=(0,r.useState)(null),p=(0,r.useRef)(null),x=(0,r.useCallback)(async()=>{try{let e=null;try{e=await fetch("".concat(n,"/logs?limit=100"),{method:"GET",headers:{"Content-Type":"application/json"}})}catch(e){console.error("Network error loading logs:",e);return}if(e&&e.ok)try{let a=await e.json();l((a.logs||[]).reverse())}catch(e){console.error("Failed to parse logs JSON:",e),l([])}else e&&console.error("Failed to load logs:",e.status,e.statusText)}catch(e){console.error("Failed to load logs:",e)}},[]),g=(0,r.useCallback)(async()=>{try{var e;let a=new Date().getTime(),t="".concat(n,"/live-preview?t=").concat(a),s=await fetch(t);if(s.ok&&(null==(e=s.headers.get("content-type"))?void 0:e.startsWith("image/"))){let e=await s.blob(),a=URL.createObjectURL(e);u(e=>(e&&e.startsWith("blob:")&&URL.revokeObjectURL(e),a))}else u(e=>(e&&e.startsWith("blob:")&&URL.revokeObjectURL(e),null))}catch(e){u(e=>(e&&e.startsWith("blob:")&&URL.revokeObjectURL(e),null))}},[]);(0,r.useCallback)(async()=>{},[]),(0,r.useEffect)(()=>{x(),g();let a=setInterval(x,1e3);return p.current=setInterval(g,e?500:2e3),()=>{clearInterval(a),p.current&&clearInterval(p.current)}},[x,g,e]),(0,r.useEffect)(()=>()=>{m&&m.startsWith("blob:")&&URL.revokeObjectURL(m)},[m]),(0,r.useEffect)(()=>{o.current&&(o.current.scrollTop=o.current.scrollHeight)},[t]);let y=async()=>{a(!0),i("running"),l([]);try{await fetch("".concat(n,"/logs"),{method:"DELETE"}).catch(()=>{});let e=async(e,a)=>{try{let t=new AbortController,s=setTimeout(()=>t.abort(),3e4),r=await fetch(e,{...a,signal:t.signal});return clearTimeout(s),r}catch(e){return null}},a=await e("".concat(n,"/scrape"),{method:"POST",headers:{"Content-Type":"application/json"}});if(a&&a.ok){let e=await a.json();i(e.success?"stopped":"error"),setTimeout(()=>{x()},1e3)}else if(a){let e="Unknown error occurred";try{let t=await a.json();e=t.detail||t.error||t.message||"Unknown error occurred"}catch(t){try{e=await a.text()||"HTTP ".concat(a.status,": ").concat(a.statusText)}catch(t){e="HTTP ".concat(a.status,": ").concat(a.statusText)}}i("error"),h("Scraper error: ".concat(e)),console.error("Scraper error:",e)}else i("error"),h("Cannot connect to Python service. Make sure it's running on port 8000.")}catch(e){i("error"),h("Failed to start scraper. Check console for details."),console.error("Failed to start scraper:",e)}finally{a(!1)}};return(0,s.jsxs)("div",{className:"ha-dashboard",children:[d&&(0,s.jsxs)("div",{className:"ha-card ha-card-error",children:[(0,s.jsxs)("div",{className:"ha-card-header",children:[(0,s.jsx)("span",{className:"ha-card-icon",children:"⚠️"}),(0,s.jsx)("strong",{children:"API Connection Error"})]}),(0,s.jsx)("div",{className:"ha-card-content",children:d})]}),(0,s.jsxs)("div",{className:"ha-card ha-card-status",children:[(0,s.jsxs)("div",{className:"ha-card-header",children:[(0,s.jsx)("span",{className:"ha-card-icon",children:"\uD83D\uDD0C"}),(0,s.jsx)("span",{children:"Service Status"})]}),(0,s.jsx)("div",{className:"ha-card-content",style:{padding:"0.5rem 0.75rem"},children:(0,s.jsxs)("div",{className:"ha-status-controls",children:[(0,s.jsxs)("div",{className:"ha-status-info",children:[(0,s.jsx)("span",{className:"ha-status-indicator ".concat(c)}),(0,s.jsx)("span",{className:"ha-status-text",children:"running"===c?"Running":"error"===c?"Error":"Stopped"})]}),(0,s.jsx)("button",{className:"ha-button ha-button-primary",onClick:y,disabled:e,children:e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("img",{src:"/images/ajax-loader.gif",alt:"Loading",className:"ha-loader-inline"}),"Running..."]}):"Start Scraper"})]})})]}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",height:"100%"},children:[(0,s.jsxs)("div",{className:"ha-card ha-card-logs",style:{display:"flex",flexDirection:"column",minHeight:0},children:[(0,s.jsxs)("div",{className:"ha-card-header",children:[(0,s.jsx)("span",{className:"ha-card-icon",children:"\uD83D\uDCDD"}),(0,s.jsx)("span",{children:"Console Logs"})]}),(0,s.jsx)("div",{className:"ha-card-content ha-log-container",ref:o,style:{flex:1,minHeight:0,overflowY:"auto"},children:0===t.length?(0,s.jsx)("div",{className:"ha-empty-state",children:"No logs yet. Start the scraper to see activity."}):t.map(e=>(0,s.jsxs)("div",{className:"ha-log-entry ha-log-".concat(e.level.toLowerCase()),children:[(0,s.jsx)("span",{className:"ha-log-time",children:(e=>{try{return new Date(e).toLocaleString()}catch(a){return e}})(e.timestamp)}),(0,s.jsxs)("span",{className:(e=>{switch(e.toLowerCase()){case"error":return"log-level-error";case"success":return"log-level-success";case"warning":return"log-level-warning";default:return"log-level-info"}})(e.level),children:["[",e.level.toUpperCase(),"]"]}),(0,s.jsx)("span",{className:"ha-log-message",children:e.message})]},e.id))})]}),(0,s.jsxs)("div",{className:"ha-card",style:{display:"flex",flexDirection:"column",minHeight:0},children:[(0,s.jsxs)("div",{className:"ha-card-header",children:[(0,s.jsx)("span",{className:"ha-card-icon",children:"\uD83D\uDDA5️"}),(0,s.jsx)("span",{children:"Browser Preview"})]}),(0,s.jsx)("div",{className:"ha-card-content",style:{flex:1,minHeight:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#1a1a1a",padding:"1rem"},children:m?(0,s.jsx)("img",{src:m,alt:"Browser preview",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain",border:"1px solid #333",borderRadius:"4px"}}):(0,s.jsx)("div",{className:"ha-empty-state",style:{textAlign:"center",color:"#888"},children:e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("img",{src:"/images/ajax-loader.gif",alt:"Loading",style:{width:"40px",height:"40px",marginBottom:"1rem"}}),(0,s.jsx)("div",{children:"Waiting for browser preview..."})]}):(0,s.jsx)("div",{children:"No preview available. Start the scraper to see browser activity."})})})]})]})]})}let c=t(5704).env.NEXT_PUBLIC_API_URL||"/api";function i(){let[e,a]=(0,r.useState)(""),[t,n]=(0,r.useState)(""),[l,i]=(0,r.useState)(""),[h,m]=(0,r.useState)(""),[u,p]=(0,r.useState)(30),[x,g]=(0,r.useState)(!1),[y,j]=(0,r.useState)(null),[b,v]=(0,r.useState)("credentials"),[f,N]=(0,r.useState)(!1),[w,S]=(0,r.useState)(!1),[k,_]=(0,r.useState)(!1),C=e=>e?"•".repeat(e.length):"";(0,r.useEffect)(()=>{D()},[]),(0,r.useEffect)(()=>{if(!l||""===l.trim()){m(""),p(30);return}let e=async()=>{try{let e=await fetch("".concat(c,"/totp"));if(e.ok){let a=await e.json();m(a.code),p(a.time_remaining)}else{let a="Error";try{let t=await e.json();a=404===e.status?"No credentials saved":400===e.status?t.detail||"Invalid TOTP secret":t.detail||"Failed to fetch TOTP"}catch(t){a=404===e.status?"No credentials saved":"Error"}m(a)}}catch(e){console.error("Failed to fetch TOTP:",e),m("Connection Error")}};e();let a=setInterval(e,1e3);return()=>clearInterval(a)},[l]);let D=async()=>{try{let e=await fetch("".concat(c,"/settings"));if(e.ok){let t=await e.json();a(t.username||""),n(""),i(t.totp_secret||""),N(!1),S(!1),_(!1)}else console.error("Failed to load settings:",await e.text())}catch(e){console.error("Failed to load settings:",e),j({type:"error",text:"Failed to connect to API. Make sure the Python service is running on port 8000."})}},T=async a=>{a.preventDefault(),g(!0),j(null);try{let a=await fetch("".concat(c,"/settings"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t||null,totp_secret:l})});if(a.ok){if(j({type:"success",text:"Settings saved successfully!"}),l){let e=await fetch("".concat(c,"/totp"));if(e.ok){let a=await e.json();m(a.code),p(a.time_remaining)}}}else{let e=await a.json();j({type:"error",text:e.detail||"Failed to save settings"})}}catch(e){j({type:"error",text:"Failed to connect to API. Make sure the Python service is running."})}finally{g(!1)}};return(0,s.jsxs)("div",{className:"ha-settings",children:[(0,s.jsxs)("div",{className:"ha-tabs",children:[(0,s.jsx)("button",{type:"button",className:"ha-tab ".concat("credentials"===b?"active":""),onClick:()=>v("credentials"),children:"\uD83D\uDD10 Credentials"}),(0,s.jsx)("button",{type:"button",className:"ha-tab ".concat("automated"===b?"active":""),onClick:()=>v("automated"),children:"⏰ Automated Scrape"}),(0,s.jsx)("button",{type:"button",className:"ha-tab ".concat("webhooks"===b?"active":""),onClick:()=>v("webhooks"),children:"\uD83D\uDD17 Home Assistant Webhooks"})]}),"credentials"===b&&(0,s.jsxs)("div",{className:"ha-card",children:[(0,s.jsxs)("div",{className:"ha-card-header",children:[(0,s.jsx)("span",{className:"ha-card-icon",children:"\uD83D\uDD10"}),(0,s.jsx)("span",{children:"Credentials"})]}),(0,s.jsxs)("div",{className:"ha-card-content",children:[(0,s.jsxs)("form",{onSubmit:T,children:[(0,s.jsxs)("div",{className:"ha-form-group",children:[(0,s.jsx)("label",{htmlFor:"username",className:"ha-form-label",children:"Username / Email"}),(0,s.jsxs)("div",{className:"password-input-wrapper",children:[(0,s.jsx)("input",{type:f?"text":"password",id:"username",className:"ha-form-input",value:f?e:e?C(e):"",onChange:e=>a(e.target.value),onFocus:()=>N(!0),placeholder:"your.email@example.com",required:!0}),(0,s.jsx)("button",{type:"button",className:"toggle-password",onClick:()=>N(!f),tabIndex:-1,"aria-label":f?"Hide username":"Show username",children:f?"\uD83D\uDC41️":"\uD83D\uDC41️‍\uD83D\uDDE8️"})]})]}),(0,s.jsxs)("div",{className:"ha-form-group",children:[(0,s.jsx)("label",{htmlFor:"password",className:"ha-form-label",children:"Password"}),(0,s.jsxs)("div",{className:"password-input-wrapper",children:[(0,s.jsx)("input",{type:w?"text":"password",id:"password",className:"ha-form-input",value:w?t:t?C(t):"",onChange:e=>n(e.target.value),onFocus:()=>S(!0),placeholder:t?"":"Enter password to update"}),(0,s.jsx)("button",{type:"button",className:"toggle-password",onClick:()=>S(!w),tabIndex:-1,"aria-label":w?"Hide password":"Show password",children:w?"\uD83D\uDC41️":"\uD83D\uDC41️‍\uD83D\uDDE8️"})]}),(0,s.jsx)("div",{className:"info-text",children:"Leave empty to keep existing password"})]}),(0,s.jsxs)("div",{className:"ha-form-group",children:[(0,s.jsx)("label",{htmlFor:"totp_secret",className:"ha-form-label",children:"TOTP Secret"}),(0,s.jsxs)("div",{className:"password-input-wrapper",children:[(0,s.jsx)("input",{type:k?"text":"password",id:"totp_secret",className:"ha-form-input",value:k?l:l?C(l):"",onChange:e=>i(e.target.value),onFocus:()=>_(!0),placeholder:"JBSWY3DPEHPK3PXP",required:!0}),(0,s.jsx)("button",{type:"button",className:"toggle-password",onClick:()=>_(!k),tabIndex:-1,"aria-label":k?"Hide TOTP secret":"Show TOTP secret",children:k?"\uD83D\uDC41️":"\uD83D\uDC41️‍\uD83D\uDDE8️"})]}),(0,s.jsx)("div",{className:"info-text",children:"Enter your TOTP secret (base32 encoded string, same as Google Authenticator)"})]}),(0,s.jsx)("button",{type:"submit",className:"ha-button ha-button-primary",disabled:x,children:x?"Saving...":"Save Settings"})]}),l&&(0,s.jsxs)("div",{className:"ha-totp-display",children:[(0,s.jsx)("h3",{children:"Current TOTP Code"}),(0,s.jsx)("div",{className:"ha-totp-code",children:h||"Loading..."}),(0,s.jsxs)("div",{className:"ha-totp-time",children:["Expires in ",u," seconds"]})]}),y&&(0,s.jsx)("div",{className:"ha-card ha-card-".concat("error"===y.type?"error":"status"),style:{marginTop:"1rem"},children:(0,s.jsx)("div",{className:"ha-card-content",children:y.text})})]})]}),"automated"===b&&(0,s.jsx)(d,{}),"webhooks"===b&&(0,s.jsx)(o,{})]})}function o(){let[e,a]=(0,r.useState)(""),[t,n]=(0,r.useState)(""),[l,i]=(0,r.useState)(""),[o,d]=(0,r.useState)(""),[h,m]=(0,r.useState)(!1),[u,p]=(0,r.useState)(null);(0,r.useEffect)(()=>{x()},[]);let x=async()=>{try{let e=await fetch("".concat(c,"/webhooks"));if(e.ok){let t=await e.json();a(t.latest_bill||""),n(t.previous_bill||""),i(t.account_balance||""),d(t.last_payment||"")}}catch(e){console.error("Failed to load webhooks:",e)}},g=async a=>{a.preventDefault(),m(!0),p(null);try{let a={latest_bill:e.trim(),previous_bill:t.trim(),account_balance:l.trim(),last_payment:o.trim()},s=await fetch("".concat(c,"/webhooks"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(s.ok){let e=await s.json();p({type:"success",text:"Webhook URLs saved successfully! (".concat(e.configured_count," configured)")}),await x()}else{let e="Failed to save webhook URLs";try{let a=await s.json();a.detail&&("string"==typeof a.detail?e=a.detail:Array.isArray(a.detail)&&(e=a.detail.map(e=>"".concat(e.loc.join("."),": ").concat(e.msg)).join(", ")))}catch(a){e="HTTP ".concat(s.status,": ").concat(s.statusText)}p({type:"error",text:e})}}catch(e){p({type:"error",text:"Failed to connect to API: ".concat(e instanceof Error?e.message:"Unknown error")})}finally{m(!1)}},y=async()=>{m(!0),p(null);try{let a=await fetch("".concat(c,"/webhooks"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({latest_bill:e,previous_bill:t,account_balance:l,last_payment:o})});if(!a.ok){let e=await a.json().catch(()=>({}));p({type:"error",text:e.detail||"Failed to save webhooks before testing"}),m(!1);return}p({type:"success",text:"Sending test webhooks with latest scraped data..."});let s=await fetch("".concat(c,"/webhooks/test"),{method:"POST"});if(s.ok){let e=await s.json();p({type:"success",text:"".concat(e.message).concat(e.webhooks_sent?" (".concat(e.webhooks_sent.join(", "),")"):"")})}else{let e=await s.json().catch(()=>({}));p({type:"error",text:e.detail||"Test webhooks failed"})}}catch(e){p({type:"error",text:"Failed to test webhooks. Make sure the Python service is running."})}finally{m(!1)}},j=e.trim()||t.trim()||l.trim()||o.trim();return(0,s.jsxs)("div",{className:"ha-card",children:[(0,s.jsxs)("div",{className:"ha-card-header",children:[(0,s.jsx)("span",{className:"ha-card-icon",children:"\uD83D\uDD17"}),(0,s.jsx)("span",{children:"Home Assistant Webhooks"})]}),(0,s.jsxs)("div",{className:"ha-card-content",children:[(0,s.jsx)("div",{className:"info-text",style:{marginBottom:"1.5rem"},children:"Configure separate webhook URLs for each event type. Each scrape will POST JSON data to the configured URLs."}),(0,s.jsxs)("form",{onSubmit:g,children:[(0,s.jsxs)("div",{className:"ha-form-group",children:[(0,s.jsx)("label",{htmlFor:"latest-bill-url",className:"ha-form-label",children:"\uD83D\uDCC4 Latest Bill Webhook"}),(0,s.jsx)("input",{type:"url",id:"latest-bill-url",className:"ha-form-input",value:e,onChange:e=>a(e.target.value),placeholder:"https://homeassistant.local/api/webhook/YOUR_WEBHOOK_ID",style:{fontFamily:"monospace",fontSize:"0.9rem"}}),(0,s.jsx)("div",{className:"info-text",children:"Sends latest bill amount, billing cycle date, and month range"})]}),(0,s.jsxs)("div",{className:"ha-form-group",children:[(0,s.jsx)("label",{htmlFor:"previous-bill-url",className:"ha-form-label",children:"\uD83D\uDCCB Previous Bill Webhook"}),(0,s.jsx)("input",{type:"url",id:"previous-bill-url",className:"ha-form-input",value:t,onChange:e=>n(e.target.value),placeholder:"https://homeassistant.local/api/webhook/YOUR_WEBHOOK_ID",style:{fontFamily:"monospace",fontSize:"0.9rem"}}),(0,s.jsx)("div",{className:"info-text",children:"Sends previous bill amount, billing cycle date, and month range"})]}),(0,s.jsxs)("div",{className:"ha-form-group",children:[(0,s.jsx)("label",{htmlFor:"account-balance-url",className:"ha-form-label",children:"\uD83D\uDCB0 Account Balance Webhook"}),(0,s.jsx)("input",{type:"url",id:"account-balance-url",className:"ha-form-input",value:l,onChange:e=>i(e.target.value),placeholder:"https://homeassistant.local/api/webhook/YOUR_WEBHOOK_ID",style:{fontFamily:"monospace",fontSize:"0.9rem"}}),(0,s.jsx)("div",{className:"info-text",children:"Sends current account balance (outstanding amount)"})]}),(0,s.jsxs)("div",{className:"ha-form-group",children:[(0,s.jsx)("label",{htmlFor:"last-payment-url",className:"ha-form-label",children:"\uD83D\uDCB3 Last Payment Webhook"}),(0,s.jsx)("input",{type:"url",id:"last-payment-url",className:"ha-form-input",value:o,onChange:e=>d(e.target.value),placeholder:"https://homeassistant.local/api/webhook/YOUR_WEBHOOK_ID",style:{fontFamily:"monospace",fontSize:"0.9rem"}}),(0,s.jsx)("div",{className:"info-text",children:"Sends last payment amount and date received"})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:"0.75rem",flexWrap:"wrap"},children:[(0,s.jsx)("button",{type:"submit",className:"ha-button ha-button-primary",disabled:h,children:h?"Saving...":"Save Webhooks"}),(0,s.jsx)("button",{type:"button",className:"ha-button",onClick:y,disabled:h||!j,style:{backgroundColor:"#1e88e5",color:"white"},children:"Test Webhooks"})]})]}),(0,s.jsxs)("div",{className:"info-text",style:{marginTop:"1rem",padding:"0.75rem",backgroundColor:"#1a1a1a",borderRadius:"4px",border:"1px solid #333"},children:[(0,s.jsx)("strong",{children:"\uD83D\uDCCB How it works:"}),(0,s.jsxs)("ul",{style:{marginTop:"0.5rem",marginBottom:0,paddingLeft:"1.25rem"},children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Smart Change Detection:"})," Webhooks are automatically sent only when values change by comparing with previous scrapes in the database"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Test Webhooks:"})," Instantly sends the latest scraped data to all configured webhooks (bypasses change detection for testing)"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Account Ledger:"})," View full history of all scrapes and changes on the Account Ledger page"]})]})]}),u&&(0,s.jsx)("div",{className:"ha-card ha-card-".concat("error"===u.type?"error":"status"),style:{marginTop:"1rem"},children:(0,s.jsx)("div",{className:"ha-card-content",children:u.text})}),(0,s.jsx)("div",{className:"ha-card",style:{marginTop:"1.5rem",backgroundColor:"#1e1e1e",border:"1px solid #333"},children:(0,s.jsxs)("div",{className:"ha-card-content",children:[(0,s.jsx)("h4",{style:{marginTop:0,marginBottom:"0.75rem",fontSize:"0.95rem"},children:"Webhook Payload Examples"}),(0,s.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,s.jsx)("strong",{style:{fontSize:"0.9rem"},children:"Latest Bill:"}),(0,s.jsx)("pre",{style:{backgroundColor:"#0a0a0a",padding:"0.75rem",borderRadius:"4px",fontSize:"0.8rem",overflow:"auto",margin:"0.5rem 0 0 0"},children:'{\n  "event_type": "latest_bill",\n  "timestamp": "2026-01-23T12:00:00",\n  "data": {\n    "bill_total": "$123.45",\n    "bill_cycle_date": "January 15, 2026",\n    "month_range": "Dec 16 - Jan 15"\n  }\n}'})]}),(0,s.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,s.jsx)("strong",{style:{fontSize:"0.9rem"},children:"Account Balance:"}),(0,s.jsx)("pre",{style:{backgroundColor:"#0a0a0a",padding:"0.75rem",borderRadius:"4px",fontSize:"0.8rem",overflow:"auto",margin:"0.5rem 0 0 0"},children:'{\n  "event_type": "account_balance",\n  "timestamp": "2026-01-23T12:00:00",\n  "data": {\n    "account_balance": 123.45,\n    "account_balance_raw": "$123.45"\n  }\n}'})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{style:{fontSize:"0.9rem"},children:"Last Payment:"}),(0,s.jsx)("pre",{style:{backgroundColor:"#0a0a0a",padding:"0.75rem",borderRadius:"4px",fontSize:"0.8rem",overflow:"auto",margin:"0.5rem 0 0 0"},children:'{\n  "event_type": "last_payment",\n  "timestamp": "2026-01-23T12:00:00",\n  "data": {\n    "amount": "$123.45",\n    "payment_date": "1/15/2026",\n    "bill_cycle_date": "1/10/2026",\n    "description": "Payment Received"\n  }\n}'})]})]})})]})]})}function d(){let[e,a]=(0,r.useState)(!1),[t,n]=(0,r.useState)("0"),[l,i]=(0,r.useState)("0"),[o,d]=(0,r.useState)("0"),[h,m]=(0,r.useState)(!1),[u,p]=(0,r.useState)(null),[x,g]=(0,r.useState)(null);(0,r.useEffect)(()=>{y()},[]);let y=async()=>{try{let e=await fetch("".concat(c,"/automated-schedule"));if(e.ok){let t=await e.json();if(g(t),t.enabled){a(!0);let e=t.frequency||0;n(Math.floor(e/3600).toString()),i(Math.floor(e%3600/60).toString()),d((e%60).toString())}}}catch(e){console.error("Failed to load schedule:",e)}},j=async a=>{a.preventDefault(),m(!0),p(null);try{let a=3600*parseInt(t)+60*parseInt(l)+parseInt(o);if(a<=0){p({type:"error",text:"Frequency must be greater than 0"}),m(!1);return}let s=await fetch("".concat(c,"/automated-schedule"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:e,frequency:a})});if(s.ok)p({type:"success",text:"Automated scrape schedule saved successfully!"}),await y();else{let e=await s.json().catch(()=>({}));p({type:"error",text:e.error||"Failed to save schedule"})}}catch(e){p({type:"error",text:"Failed to connect to API. Make sure the Python service is running."})}finally{m(!1)}};return(0,s.jsxs)("div",{className:"ha-card",children:[(0,s.jsxs)("div",{className:"ha-card-header",children:[(0,s.jsx)("span",{className:"ha-card-icon",children:"⏰"}),(0,s.jsx)("span",{children:"Automated Scrape Schedule"})]}),(0,s.jsxs)("div",{className:"ha-card-content",children:[(0,s.jsxs)("form",{onSubmit:j,children:[(0,s.jsx)("div",{className:"ha-form-group",children:(0,s.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[(0,s.jsx)("input",{type:"checkbox",checked:e,onChange:e=>a(e.target.checked),style:{width:"18px",height:"18px",cursor:"pointer"}}),(0,s.jsx)("span",{children:"Enable Automated Scraping"})]})}),e&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"ha-form-group",children:[(0,s.jsx)("label",{className:"ha-form-label",children:"Scrape Frequency"}),(0,s.jsxs)("div",{style:{display:"flex",gap:"1rem",alignItems:"flex-start"},children:[(0,s.jsxs)("div",{style:{flex:1},children:[(0,s.jsx)("label",{htmlFor:"hours",className:"ha-form-label",style:{fontSize:"0.85rem"},children:"Hours"}),(0,s.jsx)("input",{type:"number",id:"hours",className:"ha-form-input",min:"0",max:"23",value:t,onChange:e=>n(e.target.value),required:!0})]}),(0,s.jsxs)("div",{style:{flex:1},children:[(0,s.jsx)("label",{htmlFor:"minutes",className:"ha-form-label",style:{fontSize:"0.85rem"},children:"Minutes"}),(0,s.jsx)("input",{type:"number",id:"minutes",className:"ha-form-input",min:"0",max:"59",value:l,onChange:e=>i(e.target.value),required:!0})]}),(0,s.jsxs)("div",{style:{flex:1},children:[(0,s.jsx)("label",{htmlFor:"seconds",className:"ha-form-label",style:{fontSize:"0.85rem"},children:"Seconds"}),(0,s.jsx)("input",{type:"number",id:"seconds",className:"ha-form-input",min:"0",max:"59",value:o,onChange:e=>d(e.target.value),required:!0})]})]}),(0,s.jsxs)("div",{className:"info-text",style:{marginTop:"0.5rem"},children:["Scraper will run automatically every ",t,":",String(l).padStart(2,"0"),":",String(o).padStart(2,"0")]})]})}),(0,s.jsx)("button",{type:"submit",className:"ha-button ha-button-primary",disabled:h,children:h?"Saving...":"Save Schedule"})]}),u&&(0,s.jsx)("div",{className:"ha-card ha-card-".concat("error"===u.type?"error":"status"),style:{marginTop:"1rem"},children:(0,s.jsx)("div",{className:"ha-card-content",children:u.text})}),x&&x.enabled&&x.nextRun&&(0,s.jsx)("div",{className:"ha-card ha-card-status",style:{marginTop:"1rem"},children:(0,s.jsxs)("div",{className:"ha-card-content",children:[(0,s.jsx)("strong",{children:"Next scheduled run:"})," ",new Date(x.nextRun).toLocaleString()]})})]})]})}let h=t(5704).env.NEXT_PUBLIC_API_URL||"/api";function m(e){var a,t;let{onNavigate:n}=e,[l,c]=(0,r.useState)([]),[i,o]=(0,r.useState)(!0),[d,m]=(0,r.useState)(null),u=(0,r.useCallback)(async()=>{try{let e=await fetch("".concat(h,"/scraped-data?limit=50"));if(e.ok){let a=await e.json();c(a.data||[]),m(null)}else m("Failed to load scraped data")}catch(e){m("Cannot connect to Python service. Make sure it's running on port 8000.")}finally{o(!1)}},[]);if((0,r.useEffect)(()=>{u();let e=setInterval(u,3e4);return()=>clearInterval(e)},[u]),i)return(0,s.jsxs)("div",{style:{padding:"4rem 2rem",textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px"},children:[(0,s.jsx)("img",{src:"/images/ajax-loader.gif",alt:"Loading",style:{width:"64px",height:"64px",marginBottom:"1.5rem"}}),(0,s.jsx)("div",{style:{color:"#666",fontSize:"1rem",marginTop:"1rem"},children:"Loading account ledger..."})]});if(d)return(0,s.jsx)("div",{style:{padding:"2rem",textAlign:"center",color:"#d32f2f"},children:d});if(0===l.length)return(0,s.jsxs)("div",{style:{padding:"4rem 2rem",textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px"},children:[(0,s.jsx)("img",{src:"/images/ajax-loader.gif",alt:"Setup Required",style:{width:"80px",height:"80px",marginBottom:"2rem",opacity:.8}}),(0,s.jsx)("h2",{style:{fontSize:"1.5rem",fontWeight:600,color:"#333",marginBottom:"1rem"},children:"No Account Data Yet"}),(0,s.jsx)("p",{style:{color:"#666",fontSize:"1rem",maxWidth:"500px",lineHeight:"1.6",marginBottom:"2rem"},children:"To get started, please configure your credentials in Settings and run the scraper from the Console."}),(0,s.jsxs)("div",{style:{display:"flex",gap:"1rem",justifyContent:"center",flexWrap:"wrap"},children:[(0,s.jsx)("button",{onClick:()=>null==n?void 0:n("settings"),style:{padding:"0.75rem 1.5rem",backgroundColor:"#03a9f4",color:"white",border:"none",borderRadius:"4px",fontSize:"1rem",cursor:"pointer",fontWeight:500,transition:"background-color 0.2s"},onMouseOver:e=>e.currentTarget.style.backgroundColor="#0288d1",onMouseOut:e=>e.currentTarget.style.backgroundColor="#03a9f4",children:"⚙️ Go to Settings"}),(0,s.jsx)("button",{onClick:()=>null==n?void 0:n("console"),style:{padding:"0.75rem 1.5rem",backgroundColor:"#4caf50",color:"white",border:"none",borderRadius:"4px",fontSize:"1rem",cursor:"pointer",fontWeight:500,transition:"background-color 0.2s"},onMouseOver:e=>e.currentTarget.style.backgroundColor="#45a049",onMouseOut:e=>e.currentTarget.style.backgroundColor="#4caf50",children:"\uD83D\uDCCA Go to Console"})]})]});let p=l[0],x=function(e){try{let a=new Date(e),t=a.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),s=a.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0});return{date:t,time:s}}catch(a){return{date:e,time:""}}}(p.timestamp),g=(null==(a=p.data)?void 0:a.account_balance)||"-",y=p.screenshot_path,j=null==(t=p.data)?void 0:t.bill_history,b=[],v=[];(null==j?void 0:j.ledger)&&j.ledger.forEach(e=>{"bill"===e.type?b.push(e):"payment"===e.type&&v.push(e)}),b.sort((e,a)=>{try{let t=new Date(e.bill_cycle_date||e.bill_date||0);return new Date(a.bill_cycle_date||a.bill_date||0).getTime()-t.getTime()}catch(e){return 0}}),v.sort((e,a)=>{try{let t=new Date(e.bill_cycle_date||0);return new Date(a.bill_cycle_date||0).getTime()-t.getTime()}catch(e){return 0}});let f=[],N=new Set;b.forEach((e,a)=>{try{let t=e.bill_cycle_date||e.bill_date||"",s=new Date(t),r=a>0?new Date(b[a-1].bill_cycle_date||b[a-1].bill_date||0):null,n=[];v.forEach((e,a)=>{if(!N.has(a))try{let t=e.bill_cycle_date||"",l=new Date(t);(null===r?l>s:l>s&&l<=r)&&(n.push(e),N.add(a))}catch(a){console.warn("Failed to parse payment date:",e,a)}}),n.sort((e,a)=>{try{let t=new Date(e.bill_cycle_date||0);return new Date(a.bill_cycle_date||0).getTime()-t.getTime()}catch(e){return 0}}),f.push({bill:e,payments:n})}catch(a){console.warn("Failed to parse bill date:",e,a),f.push({bill:e,payments:[]})}});let w=new Set,S=f.filter(e=>{let a=e.bill.bill_cycle_date||e.bill.bill_date||"";return!w.has(a)&&(w.add(a),!0)});return(0,s.jsxs)("div",{className:"ha-ledger",children:[(0,s.jsxs)("div",{className:"ha-card ha-card-summary",children:[(0,s.jsxs)("div",{className:"ha-card-header",children:[(0,s.jsx)("span",{className:"ha-card-icon",children:"\uD83D\uDCB0"}),(0,s.jsx)("span",{children:"Account Summary"})]}),(0,s.jsx)("div",{className:"ha-card-content",children:(0,s.jsxs)("div",{className:"ha-summary-grid",children:[(0,s.jsx)("strong",{children:"Date:"})," ",(0,s.jsx)("span",{children:x.date}),(0,s.jsx)("strong",{children:"Time:"})," ",(0,s.jsx)("span",{children:x.time}),(0,s.jsx)("strong",{children:"Account Balance:"})," ",(0,s.jsx)("span",{className:"ha-summary-balance",children:g}),y&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("strong",{children:"Screenshot:"}),(0,s.jsxs)("a",{href:"".concat(h,"/screenshot/").concat(y.split("/").pop()||y),target:"_blank",rel:"noopener noreferrer",className:"ha-button ha-button-primary",style:{fontSize:"0.7rem",padding:"0.4rem 0.75rem",textDecoration:"none",display:"inline-flex",alignItems:"center",gap:"0.4rem"},children:[(0,s.jsx)("img",{src:"/images/Coned_snapshot.svg",alt:"Screenshot",style:{width:"16px",height:"16px"}}),"View Account Balance Screenshot"]})]})]})})]}),(0,s.jsxs)("div",{className:"ha-card ha-card-ledger",children:[(0,s.jsxs)("div",{className:"ha-card-header",children:[(0,s.jsx)("span",{className:"ha-card-icon",children:"\uD83D\uDCCB"}),(0,s.jsx)("span",{children:"Bill History Ledger"})]}),(0,s.jsx)("div",{className:"ha-card-content",children:S.length>0?(0,s.jsx)("div",{children:S.map((e,a)=>{let t=e.bill,r=e.payments,n=t.bill_cycle_date||t.bill_date||"Unknown";return(0,s.jsxs)("div",{className:"ha-bill-card",children:[(0,s.jsxs)("div",{className:"ha-bill-header",children:["Bill Cycle: ",n,(null==t?void 0:t.month_range)&&" (".concat(t.month_range,")")]}),(0,s.jsx)("div",{className:"ha-bill-entry",children:(0,s.jsxs)("div",{className:"ha-bill-content",children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.6rem",flexWrap:"wrap"},children:[(0,s.jsx)("span",{className:"ha-bill-badge",children:"Bill"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontWeight:600,marginBottom:"0.15rem",fontSize:"0.8rem"},children:t.month_range||"Bill"}),(0,s.jsx)("div",{style:{fontSize:"0.7rem",color:"#666"},children:t.bill_date?new Date(t.bill_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):n})]})]}),(0,s.jsx)("div",{className:"ha-bill-amount",children:t.bill_total||"-"})]})}),r.length>0&&(0,s.jsx)("div",{children:r.map((e,a)=>(0,s.jsx)("div",{className:"ha-payment-entry",children:(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"0.5rem"},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[(0,s.jsx)("span",{className:"ha-payment-badge",children:"Payment"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontWeight:500,marginBottom:"0.1rem",fontSize:"0.75rem"},children:e.description||"Payment Received"}),(0,s.jsx)("div",{style:{fontSize:"0.65rem",color:"#666"},children:e.bill_cycle_date||n})]})]}),(0,s.jsx)("div",{className:"ha-payment-amount",children:e.amount||"-"})]})},a))})]},"".concat(n,"-").concat(a))})}):(0,s.jsx)("div",{className:"ha-empty-state",children:"No bill history ledger data available. Run the scraper to collect data."})})]})]})}function u(){let[e,a]=(0,r.useState)("account-ledger");return(0,s.jsxs)("div",{className:"ha-container",children:[(0,s.jsx)("div",{className:"ha-header",children:(0,s.jsxs)("div",{className:"ha-header-content",children:[(0,s.jsx)("div",{className:"ha-logo-container",children:(0,s.jsx)("img",{src:"/images/logo.svg",alt:"ConEd Logo",width:100,height:20,style:{filter:"brightness(0) invert(1)"}})}),(0,s.jsxs)("nav",{className:"ha-nav",children:[(0,s.jsxs)("button",{className:"ha-nav-button ".concat("account-ledger"===e?"active":""),onClick:()=>a("account-ledger"),"aria-label":"Account Ledger",children:[(0,s.jsx)("span",{className:"ha-nav-icon",children:"\uD83D\uDCCB"}),(0,s.jsx)("span",{children:"Account Ledger"})]}),(0,s.jsxs)("button",{className:"ha-nav-button ".concat("console"===e?"active":""),onClick:()=>a("console"),"aria-label":"Console",children:[(0,s.jsx)("span",{className:"ha-nav-icon",children:"\uD83D\uDCCA"}),(0,s.jsx)("span",{children:"Console"})]}),(0,s.jsxs)("button",{className:"ha-nav-button ".concat("settings"===e?"active":""),onClick:()=>a("settings"),"aria-label":"Settings",children:[(0,s.jsx)("span",{className:"ha-nav-icon",children:"⚙️"}),(0,s.jsx)("span",{children:"Settings"})]})]})]})}),(0,s.jsxs)("div",{className:"ha-content",children:["console"===e&&(0,s.jsx)(l,{}),"account-ledger"===e&&(0,s.jsx)(m,{onNavigate:e=>a(e)}),"settings"===e&&(0,s.jsx)(i,{})]})]})}},3969:(e,a,t)=>{Promise.resolve().then(t.bind(t,3046))}},e=>{e.O(0,[441,255,358],()=>e(e.s=3969)),_N_E=e.O()}]);